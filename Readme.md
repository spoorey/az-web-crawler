# AZ-Crawler
[Readme auf Deutsch](Readme_de.md)

A script that crawls through the articles on aargauerzeitung.ch, visualising the amount of articles per municipality on a html map.

This script is my personal project work for the `matl` module at the FHNW.

## How it works

![Example map](data/example.png)

These scripts work by first fetching all the required data using aargauerzeitung's json api.
Then these articles are matched with a part of the html vector graphic in `data/map.html`, and a color is calculated based on the amount of articles per municipality.
These colors are then displayed on the html map using javascript.
Due to the massive amount of articles for the cities of Aarau, Brugg and Baden, they are not included in the visualization of the total amount of articles. This can be changed in `config.py`.
If you wish to display the amount of articles for these cities correctly, you should increase the maximum amount of articles in the config file and recrawl the news.

## Running the script
It is recommended to use anaconda to run the script. An anaconda environment is included in the repository.
Run these commands to activate the anaconda environment:

`conda env create -f conda-environment.yaml`

`conda activate spoorey-azcrawler`

Then run these scripts in this order:
1. `python crawl-cities.py` To store all the cities locally
2. `python crawl-news.py` To cache the articles of the last three months for each city
3. `python visualize-articles.py`
To visualize the amount of articles on the map.
Optionally, add a an argument `color` with value `blue` (shades of blue) or `log` (logarithmic scale) (see `colorcodes.py`) e.g.: `python visualize-articles.py color=blue`.
If you wish a vizualisation with articles per inhabitant, add `mode=per-inhabitant`.
These two options can also be combined: `python visualize-articles.py color=blue mode=per-inhabitant`


Then open `vendor/map.html` in your browser.

## File structure
### `cache` directory
This directory contains cached versions of all the data acquired from the az api, or otherwise generated by the script.
### `data` directory
This contains all data required to display the map (`vendor/map.html`). This includes a javascript that was used to assign the city names to the vector paths (`data/map-names-and-ids.js`) as well as the manually corrected list of paths and city names which was created by manually improving the result of said script (`data/names-and-ids.json`)
### `vendor/map.html`
This is a map converted from a [vector file](https://www.ag.ch/de/dfr/geoportal/themenkarten/download/Kartendownload.jsp) provided by the Canton of Aargau.
### `colorcodes.py`
This contains functions to calculate a colorcode based on the amount of articles about a city and the maximum amount of articles for a single city.
### `conda-environment.yaml`
The anaconda environment configuration used to run these scripts
### `config.py`
Contains basic configuration. This file can be edited to adjust settings like ignored cities and cache locations.
### `crawl-cities.py`
Loads all cities from aargauerzeitungs API.
### `crawl-news.py`
Loads the required articles from aargauerzeitungs API.
### `visualize-articles.py`
Creates a javascript to color the map.
